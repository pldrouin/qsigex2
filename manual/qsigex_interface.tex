\chapter{General Interface of QSigEx}
\section{Overview}
As it has been explained in preceeding sections, QSigEx is divided in main modules that each accomplish one of the six (or seven) steps needed to evaluate the parameters.
To perform this task, the modules need to share some information.
To improve the flexibility of the code and to allow the users to access the infomation easily, it is done using a \texttt{TDirectory} structure.
\texttt{TDirectory} is an important ROOT class that is, among others, the class from which is derived \texttt{TFile}.

In QSigEx, a given main module doesn't depend directly on another one.
Instead, each module reads the needed information  and writes its results in the \texttt{TDirectory} structure.
It allows the developer to define and use a new module without having to modify the others.
Moreover, since all the main classes of QSigEx are derived from a common abstract base class, the member functions of a module can be called using a pointer to its base class, increasing the flexibility of the code.

All the information produced by the main modules is added to the \texttt{TDirectory} structure, as standard ROOT objects (\texttt{TTree}, \texttt{TF1}, \texttt{TNamed}, etc.) or as QSigEx objects derived from \texttt{TObject} (example: \texttt{QSigExDis} derived classes).
In all cases, almost all the information can be easily accessed using a ROOT \texttt{TBrowser} object.
For example, the parameters values are written as \texttt{TNamed} objects, which title is the fit value.
Also, all the marginal PDFs, data marginal probability densities and joint probability densities can be plotted by a simple mouse click in a \texttt{TBrowser}.

Since some initial information has to be provided to the main modules, the user has to write configuration parameters in a file before to run QSigEx.

\section{\texttt{QSigExDirHandler}: A Common Interface}
\texttt{QSigExDirHandler} is an abstract base class for the main QSigEx classes.
It provides a common interface for all these classes, such that the user already knows the basic behaviour of the member functions of a main module before starting using it.
Another advantage of \texttt{QSigExDirHandler} is that it allows to hold a pointer to a main class instance that has one of the six (or seven) roles described earlier without hardcoding it's class name.
The following subsections describe the behaviour of the pure virtual member functions declared in the \texttt{QSigExDirHandler} class, but also some of the public member functions implemented in this class. 

\subsection{\texttt{void SetDir(TDirectory* folder)}}
This function sets the address of the \texttt{TDirectory} instance that is used to hold the information of QSigEx.
This \texttt{TDirectory} is the root directory of the QSigEx structure.
A \texttt{TFile} pointer, or a pointer to an instance of any class derived from \texttt{TDirectory} can be passed.

\subsection{\texttt{TDirectory* GetDir()}}
This function returns a pointer to the \texttt{TDirectory} instance previously set using \texttt{QSigExDirHandler::SetDir}.

\subsection{\texttt{void LoadCardFile(const Char{\_}t* cardfilename)}}
This pure virtual member funcion reads the content of the configuration file which filename is \texttt{cardfilename} and stores the information related to the module into its internal member variables. 

\subsection{\texttt{void ClearCardBuf()}}
This pure virtual member function erases the information held by the internal member variables of the module where is stored the information from the configuration file.

\subsection{\texttt{Int{\_}t Get()}}
This pure virtual member function uses the information stored in the internal variables of the module and from the \texttt{TDirectory} structure to accomplish the task assigned to the module.
The results of this task are stored in the \texttt{TDirectory} structure. 

\subsection{\texttt{void CleanDir()}}
This pure virtual member function removes all the previous results associated with the current instance from the \texttt{TDirectory} structure.
It also deletes the \texttt{TDirectory} objects created by the instance.

\section{The Configuration File}
To configure QSigEx, the user has to create a configuration file (card file).
Some of the main modules need to read parameters from this file and some other do not.
The configuration file entries format depends also on the main module.
The user should look at the QSigEx autogenerated HTML~\cite{QSigEx:HTML} documentation produced with ROOT to learn in details the card file syntax.
Figure \ref{qi:cf:ex} shows a configuration file example.

\begin{figure}
\centering
\input{qi_cf_ex}
\caption{An example of a QSigEx configuration file}
\label{qi:cf:ex}
\end{figure} 

\section{The \texttt{TDirectory} Structure}
The main modules produce results that are stored in the QSigEx \texttt{TDirectory} structure.
A pointer to the root of this structure has to be passed to initialize the classes derived from \texttt{QSigExDirHandler}.
Each one of these classes modifies the structure, by adding subdirectories and other types of objects.
Even if the \texttt{TDirectory} structure can differ depending on the specific classes that are used to get the parameters values, there are some subdirectories of this structure that are created independently of the main modules combination that is used.
For more details on the specific interface of a given class, please refer to the QSigEx autogenerated HTML~\cite{QSigEx:HTML} documentation.
A description of the common QSigEx directories is provided in this section.
The module numbers are the ones described in section \ref{gs:mm}.

\subsection{``Cuts'' \texttt{TDirectory}}
The ``Cuts'' \texttt{TDirectory} is created by a module \ref{gs:mm:cuts}.
It contains the subdirectories ``Equivalences'' and ``Cuts Expressions'' that are both used by modules \ref{gs:mm:cdata} and \ref{gs:mm:pdfs} to apply cuts.
The first subdirectory contains a set of formul\ae\  that allow to simplify the cuts expressions.
One equivalence, for example, can combine the variables $x$, $y$ and $z$ to express the radius $r$ as $\sqrt{x^2+y^2+z^2}$.
A cut, defined in the ``Cuts Expressions'' \texttt{TDirectory}, can use this equivalence to express limits on the radius values. 


\subsection{``Event Info'' \texttt{TDirectory}}
The ``Event Info'' \texttt{TDirectory} contains the information related to the data sample used in the fit.
Only the events within the predefined cuts are written in this directory.
The information is written by a module \ref{gs:mm:cdata} as a \texttt{TTree} which branches contain Float{\_}t values. 

\subsection{``PDFs'' \texttt{TDirectory}}
This \texttt{TDirectory} is used to save the information related to the population probability density functions $f(\vec{x}|G_j)$.
``PDFs'' is subdivided in directories that represent the population groups.
Each one of these directories contains \texttt{TDirectory} objects that are named according to the systematic groups of the population.
These groups are not used in the fitting process of QSigEx, but are useful if one wants to compute systematic errors on the fitted parameters.
Inside these folders are contained the marginal PDFs
directories.
A PDF \texttt{TDirectory} is basically composed of an object derived from \texttt{QSigExDis} (the PDF itself) and an ``Inputs'' directory where are listed the PDF coordinates names.
Other objects can be written in one of the described directory levels if, for example, correlations have to be computed between the variables.
Modules \ref{gs:mm:pdfs} and if needed a module \ref{gs:mm:cor} add content to ``PDFs'' \texttt{TDirectory}. 

\subsection{``Probs'' \texttt{TDirectory}}
The ``Probs'' \texttt{TDirectory} is divided into two subdirectories: ``PDFsProbs'' and ``JointPDFsProbs''.
These folders contain the marginal probability densities and the joint probability densities respectively.
Both contain \texttt{TTree} objects which branches are composed of Double{\_}t values.
Modules \ref{gs:mm:mpd} and \ref{gs:mm:jpd} contribute to the ``Probs'' \texttt{T\-Di\-rec\-to\-ry}. 

\subsection{``Fit'' \texttt{TDirectory}}
The modules \ref{gs:mm:fit} write their results and the parameters configuration in the ``Fit'' \texttt{TDirectory}.
The user should refer to the HTML~\cite{QSigEx:HTML} documentation for more details. 
